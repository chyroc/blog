<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>slice 与底层数组引用 | Chyroc的博客</title><link rel=stylesheet href=/css/style.css><link href=//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css rel=stylesheet></head><body><nav><ul class=menu><li><a href=/>主页</a></li><li><a href=/blogroll/>友链</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>slice 与底层数组引用</span></h1><h2 class=date>2018/01/25</h2></div><main><pre><code class=language-go>package main

import (
	&quot;fmt&quot;
)

func main() {
	s := []int{1, 2, 3}
	ss := s[1:]
	for i := range ss {
		ss[i] += 10
	}
	fmt.Println(s)
	ss = append(ss, 4)
	for i := range ss {
		ss[i] += 10
	}
	fmt.Println(s)
}
</code></pre><p>结果是</p><pre><code class=language-plain>[1 12 13]
[1 12 13]
</code></pre><p>也就是说第一个循环改变了 s，第二个循环没有改变。</p><p>为什么会这样呢，因为在第一个循环中，s 和 ss 都是 slice，底层共用的是一个数组，所以改变 ss 的时候，实际上改变的是底层的数组，所以 s 也会跟着改变。</p><p>在第二个循环中，<code>ss = append(ss, 4)</code>这句话会将 ss 底层引用的数组改变，所以从这里开始 s 和 ss 就没有关联了。所以改变 ss 的时候，并不会改变 s。</p><p>可以打印出 slice 的底层数组印证一下：</p><pre><code class=language-go>package main

import (
	&quot;fmt&quot;
	&quot;reflect&quot;
	&quot;unsafe&quot;
)

func printArrayOfSlice(msg string, s []int) {
	hdr := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s))
	data := *(*[3]int)(unsafe.Pointer(hdr.Data))
	fmt.Printf(&quot;%s \tarray\t%+v\n&quot;, msg, data)
}

func main() {
	s := []int{1, 2, 3}
	ss := s[1:]
	for i := range ss {
		ss[i] += 10
	}
	printArrayOfSlice(&quot;s&quot;, s)
	printArrayOfSlice(&quot;ss&quot;, ss)

	ss = append(ss, 4)
	for i := range ss {
		ss[i] += 10
	}
	printArrayOfSlice(&quot;s&quot;, s)
	printArrayOfSlice(&quot;ss&quot;, ss)
}
</code></pre><p>结果是</p><pre><code class=language-plain>s 	array	[1 12 13]
ss 	array	[12 13 842350739296]
s 	array	[1 12 13]
ss 	array	[22 23 14]
</code></pre><p>说明的我的想法：ss 在前后所引用底层数组改变了。</p><h2 id=参考>参考</h2><ul><li><a href=https://github.com/goquiz/goquiz.github.io>https://github.com/goquiz/goquiz.github.io</a></li></ul></main><footer><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src=../../js/jquery-3.3.1.min.js></script><script src=../../js/code.js></script><script src=../../css/highlight.css></script><script src=../../js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init();</script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><hr>&copy; <a href=https://chyroc.cn>chyroc</a> <a href=https://themes.gohugo.io/hugo-xmin/>Theme By hyde</a> 2021
<span id=reading-statistics><span></footer><div id=git-comments></div><link rel=stylesheet href=https://imsun.github.io/gitment/style/default.css><script src=https://imsun.github.io/gitment/dist/gitment.browser.js></script><script>var gitment=new Gitment({id:'subslice-grow',title:'slice 与底层数组引用',owner:'Chyroc',repo:'chyroc.github.io',oauth:{client_id:'36628d87f0ace3c0f34c',client_secret:'814e29f878a31ddf2a0f8f010c2bc3615750a998',}})
gitment.render('git-comments')</script></body></html>