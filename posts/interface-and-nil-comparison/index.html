<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>interface 与 nil 的比较 | Chyroc的博客</title><link rel=stylesheet href=/css/style.css><link href=//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css rel=stylesheet></head><body><nav><ul class=menu><li><a href=/>主页</a></li><li><a href=/blogroll/>友链</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>interface 与 nil 的比较</span></h1><h2 class=date>2018/01/25</h2></div><main><pre><code class=language-go>package main

type S struct{}

func (s S) F() {}

type IF interface {
	F()
}

func InitType() S {
	var s S
	return s
}

func InitPointer() *S {
	var s *S
	return s
}
func InitEfaceType() interface{} {
	var s S
	return s
}

func InitEfacePointer() interface{} {
	var s *S
	return s
}

func InitIfaceType() IF {
	var s S
	return s
}

func InitIfacePointer() IF {
	var s *S
	return s
}

func main() {
	//println(InitType() == nil)
	println(InitPointer() == nil)
	println(InitEfaceType() == nil)
	println(InitEfacePointer() == nil)
	println(InitIfaceType() == nil)
	println(InitIfacePointer() == nil)
}

</code></pre><p>结果是</p><pre><code class=language-plain>// cannot convert nil to type S
true
false
false
false
false
</code></pre><p>第一个<code>cannot convert nil to type S</code>是？</p><p>true 是因为函数返回的是指针类型，指针类型的零值是 nil</p><p>后面的结果都是 false 的原因是：后面的函数返回的结果都是 interface，而一个 interface 如果想要等于 nil 的话，那么它的<code>类型</code>和<code>值</code>都必须等于 nil，也就是说必须明确的返回 nil 才可以。但是这些函数都是返回来了含有类型的 interface，所以不等于 nil。</p><h2 id=参考>参考</h2><ul><li><a href=https://github.com/goquiz/goquiz.github.io>https://github.com/goquiz/goquiz.github.io</a></li><li><a href=https://stackoverflow.com/questions/26845572/expecting-nil-but-getting-an-interface-with-a-nil-value-in-return-which-should>go - Expecting nil but getting an interface with a nil value in return, which should be nil - Stack Overflow</a></li></ul></main><footer><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src=../../js/jquery-3.3.1.min.js></script><script src=../../js/code.js></script><script src=../../css/highlight.css></script><script src=../../js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init();</script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><hr>&copy; <a href=https://chyroc.cn>chyroc</a> <a href=https://themes.gohugo.io/hugo-xmin/>Theme By hyde</a> 2021
<span id=reading-statistics><span></footer><div id=git-comments></div><link rel=stylesheet href=https://imsun.github.io/gitment/style/default.css><script src=https://imsun.github.io/gitment/dist/gitment.browser.js></script><script>var gitment=new Gitment({id:'interface-and-nil-comparison',title:'interface 与 nil 的比较',owner:'Chyroc',repo:'chyroc.github.io',oauth:{client_id:'36628d87f0ace3c0f34c',client_secret:'814e29f878a31ddf2a0f8f010c2bc3615750a998',}})
gitment.render('git-comments')</script></body></html>