<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Token、认证与授权 | Chyroc的博客</title><link rel=stylesheet href=/css/style.css><link href=//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css rel=stylesheet></head><body><nav><ul class=menu><li><a href=/>主页</a></li><li><a href=/blogroll/>友链</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Token、认证与授权</span></h1><h2 class=date>2018/04/08</h2></div><main><blockquote><p>这篇文章是我在公司内部分享的 paper（去掉了敏感信息之后），在这里贴一下~</p></blockquote><ul><li>什么是认证和授权</li><li>有哪些方式</li><li><h2 id=我们是怎么设计的>我们是怎么设计的</h2><h1 id=认证和授权>认证和授权</h1><table><thead><tr><th>认证 <em>authentication</em></th><th>授权 <em>authorization</em></th></tr></thead><tbody><tr><td>~~X~~</td><td>~~√~~</td></tr><tr><td>X</td><td>X</td></tr><tr><td>√</td><td>X</td></tr><tr><td>√</td><td>√</td></tr></tbody></table></li><li><p>公开的数据/可以匿名访问的</p></li><li><p>验证有效的 user</p></li><li><h2 id=需要-acl-系统验证>需要 ACL 系统验证</h2><h1 id=有哪些方式>有哪些方式</h1></li><li><p>Cookie 与 Session</p></li><li><p>Basic Auth</p></li><li><p>JWT</p></li><li><h2 id=oauth2>OAuth2</h2><h2 id=cookie-与-session>Cookie 与 Session</h2></li><li><p>Cookie：键值对；Set-Cookie</p></li><li><p>Session：浏览器存储 cookie，包含 session-id；服务端验证 session-id 有效性，并获取 user 信息</p></li><li><p>优点：简单</p></li><li><p>缺点</p><ul><li>对非浏览器端不友好</li><li>CSRF：Cross Site Request Forgery，跨站请求伪造
<img src=https://media.chyroc.cn/img/csrf.jpg alt></li></ul></li></ul><hr><h2 id=basic-auth>Basic Auth</h2><ul><li>Header: <code>Authorization: &quot;Basic &quot; + base64(username:password)</code></li><li>优点：简单</li><li><p>缺点</p><ul><li>明文传输用户名和密码</li><li><h2 id=无法提供更多有效信息-只有用户名>无法提供更多有效信息，只有用户名</h2><h2 id=jwt>JWT</h2></li></ul></li><li><p>JWT：JSON Web Token</p></li><li><p>由三段构成：header、payload、signature，三段都进行 base64 编码，由”.”连接起来</p><ul><li>header：类型与摘要算法（{&lsquo;typ&rsquo;: &lsquo;JWT&rsquo;,&lsquo;alg&rsquo;: &lsquo;HS256&rsquo;}），指示其余部分如何解析与生成</li><li>payload：Issuer/Audience/Expiration Time/Issued At，任何需要的业务信息</li><li>signature：使用第一段的签名算法对前两段的数据进行签名</li></ul></li><li><p>保证有效性：第三段信息对前两段信息进行摘要，保证前两段信息没有被篡改</p></li><li><h2 id=摘要算法可以是对称的-也可以是非对称的>摘要算法可以是对称的，也可以是非对称的</h2></li><li><p>优点</p><ul><li>不需要中心服务器，可以独立的验证有效性（非对称）</li><li>不需要服务器存储</li></ul></li><li><p>缺点</p><ul><li>无法主动失效已经签发的 jwt token</li><li><h2 id=过期需要重新登录>过期需要重新登录</h2><h2 id=oauth2-1>OAuth2</h2></li></ul></li><li><p>两种：access_token 和 refresh_token（optional）</p></li><li><p>签发与验证、刷新</p></li><li><p>与 OAuth1 对比</p><ul><li>新增了 refresh_token（optional）</li><li>access_token 变短</li><li>使用更简单
&mdash;-</li></ul></li><li><p>优点</p><ul><li>使 access_token 有效期变短，access_token 的泄露造成的危害性有时间限制</li><li>可刷新，token 过期的时候，不需要重新登录</li></ul></li><li><p>缺点</p><ul><li>refresh_token 提高了客户端操作的复杂性</li><li>客户端刷新操作复杂</li></ul></li><li><h2 id=access-token-是否在服务端存储-memory-redis-mysql>access_token 是否在服务端存储 memory/redis/mysql？</h2></li></ul><p><strong>时序图</strong></p><p><img src=https://media.chyroc.cn/img/auth2-refresh-token.png alt></p><hr><p><strong>第三方授权时序图</strong></p><p><img src=https://media.chyroc.cn/img/auth2-third-party.png alt></p><hr><h2 id=del-我们是怎么设计的-del><del># 我们是怎么设计的</del></h2><h1 id=安全性>安全性</h1><ul><li>HTTPS</li><li>弱口令/暴力破解</li><li><h2 id=二次验证-two-factor-authentication>二次验证 Two-factor Authentication</h2><h1 id=q-a>Q &amp; A</h1><hr><h1 id=谢谢大家>谢谢大家</h1><hr></li></ul></main><footer><script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src=../../js/jquery-3.3.1.min.js></script><script src=../../js/code.js></script><script src=../../css/highlight.css></script><script src=../../js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init();</script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><hr>&copy; <a href=https://chyroc.cn>chyroc</a> <a href=https://themes.gohugo.io/hugo-xmin/>Theme By hyde</a> 2021
<span id=reading-statistics><span></footer><div id=git-comments></div><link rel=stylesheet href=https://imsun.github.io/gitment/style/default.css><script src=https://imsun.github.io/gitment/dist/gitment.browser.js></script><script>var gitment=new Gitment({id:'token-token-authentication-authorization',title:'Token、认证与授权',owner:'Chyroc',repo:'chyroc.github.io',oauth:{client_id:'36628d87f0ace3c0f34c',client_secret:'814e29f878a31ddf2a0f8f010c2bc3615750a998',}})
gitment.render('git-comments')</script></body></html>